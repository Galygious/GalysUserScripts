<script type="text/javascript">
				
    function exportLeadsOptions() {
        $("#exportLeadsOptions").slideDown();
    }			
    function cancelExportLeadsOptions() {
        $("#exportLeadsOptions").slideUp();
    }

    function editLead(id) {
        location.href="/admin/leads/" + id + "/";
    }
    
    function exportLeads() {
        var win = window.open('/admin/leads/export/12295/');
    }
    function exportLeadsAll() {
        var win = window.open('/admin/leads/export/12295/all/');
    }
    
    function deleteLead( leadID ) {
        swal({
            title: 'Are you sure?',
            html: 'Are you sure you want to delete this lead? <br /> This action can NOT be undone!',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            confirmButtonClass: 'confirm-class',
            cancelButtonClass: 'cancel-class',
            closeOnConfirm: true,
            closeOnCancel: true
        }, function(isConfirm) {
            if (isConfirm) {
                $.ajax({	type: "GET",	url: "/admin/fn/leads/deleteLead/",
                    data: "clientID=12295&leadID=" +   escape(  leadID  ),
                    success: function(   data   ){
                        var results = data.split("{|}");
                        if(results[0] == "SUCCESS") {									
                            $("#row_" + leadID).html("");
                            $("#row_" + leadID).hide();
                            $("#row_" + leadID).remove();
                        } else {
                            swal({
                                type: 'error',
                                title: 'Error',
                                html: results[1]
                            });
                        }
                    }
                });
            } 
        });
    }
    
    
    
    function changeLeadPriority (leadID,priority) {		
        $.ajax({	type: "POST",	url: "/admin/fn/leads/updateLeadPriority/",
            data: {clientID: '12295', leadID: leadID, priority: priority},
            success: function(   data   ){
                var results = data.split("{|}");
                if(results[0] == "SUCCESS") {
                    if(typeof refreshLeads === 'function'){
                        refreshLeads();
                    }
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    function switchLeadStatus(leadID,newStatusID) {
        $.ajax({	type: "POST", url: "/admin/fn/leads/switchLeadStatus/",
            data: {clientID: '12295', leadID: leadID, statusID: newStatusID}, 
            success: function(   data   ){
                var results = data.split("{|}");			
                if(results[0] == "SUCCESS") {
                    //refresh the other leads listing
                    if(typeof refreshLeads === 'function'){
                        refreshLeads();
                    }
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    function cancelInlineEditPriority(leadID) {
        $("#inlineLeadPriorityEditDIV_" + leadID).slideUp('fast');
    }
    function inlineEditLeadPriority(leadID) {
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeadPriorityChooseForm/",
            data: {clientID:'12295',leadID: leadID},
            success: function(   data   ){
                var results = 			data.split("{|}");
                if(results[0] == "SUCCESS") {
                    $("#inlineLeadPriorityEditDIV_" + leadID).html(results[1]);
                    $("#inlineLeadPriorityEditDIV_" + leadID).slideDown('fast');
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    function cancelInlineEditStatus(leadID) {
        $("#inlineLeadStatusEditDIV_" + leadID).slideUp('fast');
    }
    function inlineEditLeadStatus(leadID) {
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeadStatusChooseForm/",
            data: {clientID:'12295',leadID: leadID},
            success: function(   data   ){
                var results = 			data.split("{|}");
                if(results[0] == "SUCCESS") {
                    $("#inlineLeadStatusEditDIV_" + leadID).html(results[1]);
                    $("#inlineLeadStatusEditDIV_" + leadID).slideDown('fast');
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    
    
    function refreshArchiveReasonCombo(selected) {
        $.ajax({	type: "POST",	url: "/admin/fn/leads/refreshArchiveReasonCombo/",
            data: {clientID:'12295',comboName: 'archiveReason'},
            success: function(   data   ){
                var results = 			data.split("{|}");
                if(results[0] == "SUCCESS") {
                    
                    $("#archiveReasonComboHolder").html(results[1]);
                    $("#archiveReason").val(selected);
                    $("#archiveReason").change();
                                                    
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    function showAddArchiveReasonToCombo() {
        swal({
            title: 'Add Archive Reason',
            html: '<p><div style="text-align: center; width: 250px; margin-left: auto; margin-right: auto;"><input id="quickTypeName" class="form-control" /></div></p>',
            showCancelButton: true,
            closeOnConfirm: true
        },
        function(){
            var title = 			$('#quickTypeName').val(),
                error = 			"";
                
                
                error += 			(title == "") ? "Name is a required field<Br />" : "";
            
                if(error == "") {	
                    
                    $.ajax({	type: "POST",	url: "/admin/fn/leads/addArchiveReason/",
                        data: {clientID:'12295', reason: title},
                        success: function(   data   ){
                            var results = 			data.split("{|}");
                            if(results[0] == "SUCCESS") {
                                
                                refreshArchiveReasonCombo(results[2]);
                                
                                
                            } else {
                                swal({
                                    type: 'error',
                                    title: 'Error',
                                    html: results[1]
                                });
                            }
                        }
                    });
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: error
                    });
                }
        });
    }
    
    function archiveLeadReason(leadID) {
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getArchiveLeadForm/",
            data: {clientID: '12295', leadID: leadID },
            success: function(   data   ){
                var results = data.split("{|}");
                if(results[0] == "SUCCESS") {
                    
                    modalContent = 			'<div class="modalBorderBox" style="width: 400px;">';
                    modalContent += 				'<div class="modalHeader"><div class="leftTitle headerTitle"><i class="icon-folder-alt"></i> Archive Lead </div>';
                    modalContent += 				'<div class="rightTitle"><a href="javascript:void(0);" onclick="cancelArchiveReason();" ><span class="icon-cancel"></span></a></div>';
                    modalContent += 				'</div>';
                    modalContent += 				results[1];
                    modalContent += 			'</div>';
                    modal.open({content: modalContent});
                    
                    $('#modalContent [data-toggle="popover"]').popover({
                        trigger: 'hover',
                        'placement': 'top',
                        'show': true,
                        container: 'body'
                    });
                    
                                        
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    function cancelArchiveReason() {
        $("#archiveReasonDiv").slideUp();
        $("#archiveLeadID").val('');
        modal.close();
    }
    
    function archiveLead( ) {
        
        var archiveReason =  $("#archiveReason").val();
        if(archiveReason == "") {
            swal({
                type: 'error',
                title: 'Error',
                html: "Please choose a reason for archiving this lead."
            });
            return false;
        }
        swal({
            title: 'Are you sure?',
            html: 'Are you sure you want to archive this lead?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            confirmButtonClass: 'confirm-class',
            cancelButtonClass: 'cancel-class',
            closeOnConfirm: true,
            closeOnCancel: true
        }, function(isConfirm) {
            if (isConfirm) {
                $.ajax({	type: "GET",	url: "/admin/fn/leads/archiveLead/",
                    data: "clientID=12295&leadID=" +   $("#archiveLeadID").val() + "&reasonID=" + escape(archiveReason),
                    success: function(   data   ){
                        var results = data.split("{|}");
                        if(results[0] == "SUCCESS") {
                            cancelArchiveReason();
                            refreshLeads();
                        } else {
                            swal({
                                type: 'error',
                                title: 'Error',
                                html: results[1]
                            });
                        }
                    }
                });
            } 
        });
    }
    function unArchiveLead( leadID ) {
        swal({
            title: 'Are you sure?',
            html: 'Are you sure you want to un-archive this lead?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            confirmButtonClass: 'confirm-class',
            cancelButtonClass: 'cancel-class',
            closeOnConfirm: true,
            closeOnCancel: true
        }, function(isConfirm) {
            if (isConfirm) {
                $.ajax({	type: "GET",	url: "/admin/fn/leads/unArchiveLead/",
                    data: "clientID=12295&leadID=" +   escape(  leadID  ),
                    success: function(   data   ){
                        var results = data.split("{|}");
                        if(results[0] == "SUCCESS") {									
                            refreshLeads();
                        } else {
                            swal({
                                type: 'error',
                                title: 'Error',
                                html: results[1]
                            });
                        }
                    }
                });
            } 
        });
    }
    
    function showLeadFiltering() {
        $('.navmenu').offcanvas('show');
    }
    function closeLeadFiltering() {
        $('.navmenu').offcanvas('hide');
    }
    
    
    function refreshLeads() {
        changePage($("#currentpage").val());
    }
    
    
            
    function changePage(pageNum) {
        
        var sectionArray = ['id','status','date','name','type','source','created','contacted'];
        var section = "";
        
        for(var z=0; z<sectionArray.length; z++) {
            if($("#" + sectionArray[z] + "_sort").val() == "1") {
                section = sectionArray[z];
            }
        }
        
        // Set the current page globally
        $("#currentpage").val(pageNum);
        
        var view = $("#thecurrentview").val();
        
        var sectionValue = $("#" + section + "_sort").val();
        var dirValue = $("#" + section + "_sort_dir").val();
        
        var error = 				"",
            errorField = 			$("#errorLeads"),
            brands = 				$("#filterBrand").val(),
            eventType = 			$("#filterEventType").val(),
            categories = 			$("#filterCategory").val(),
            categoryType = 			$("#category_filter_type").val(),
            statuses = 				$("#filterStatus").val(),
            viewFilter = 			$("#viewFilterCombo").val(),
            referralSource = 		$("#referralSourceCombo").val(),
            firstContactStart = 	$("#firstContactStart").val(),
            firstContactEnd = 		$("#firstContactEnd").val(),
            eventDateStart = 		$("#eventDateStart").val(),
            eventDateEnd = 			$("#eventDateEnd").val(),
            person = 				$("#filterStaffCombo").val(),
            numPerPage = 			$("#itemsPerPage_lead").val(),
            priority = 				$("#priorityCombo").val(),	//added on [10.09.2k18] : TH
            readUnread = 			$("#readUnreadCombo").val(),	//added on [10.10.2k19] : TH
            
            customFieldFilters = 	$("#objectListingCustomFieldFilters").find('input,select,textarea').serialize();	//added on [05.24.2k19] : TH

            
            //added on [01.12.2k18] : TH
            if($('#filterStaffCombo').data('ddslick') != null && $('#filterStaffCombo').data('ddslick') != undefined) {
                if($('#filterStaffCombo').data('ddslick').selectedData != undefined) {
                    person = 		$('#filterStaffCombo').data('ddslick').selectedData.value;
                }
            }
            
            if(categories !== null && categories !== undefined) {
                if(categories.length > 0) {
                    if(categories[0] == "ALL") {
                        categories.splice(0,1);
                    }
                }
                categories = 			categories.join("||");
            }
            
            if(statuses !== null && statuses !== undefined) {
                if(statuses.length > 0) {
                    if(statuses[0] == "ALL") {
                        statuses.splice(0,1);
                    }
                }
                statuses = 			statuses.join("||");
            }
            if(brands !== null && brands !== undefined) {
                if(brands.length > 0) {
                    if(brands[0] == "ALL") {
                        brands.splice(0,1);
                    }
                }
                brands = 			brands.join("||");
            }
            
            errorField.hide();
            
            $("#leadsLoad").show();
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeads/",
            data: {clientID: '12295', page: pageNum, section: section, person: person, statuses: statuses, brands: brands, viewFilter: viewFilter, eventType: eventType, readUnread: readUnread,
                    dir: dirValue, referralSource: referralSource, firstContactStart: firstContactStart, firstContactEnd: firstContactEnd, view: view, eventDateStart: eventDateStart,
                    eventDateEnd: eventDateEnd, categories: categories, numPerPage: numPerPage, categoryType: categoryType, customFieldFilters: customFieldFilters, priority: priority },
            success: function(   data   ){
                var results = 			data.split("{|}");
                $("#leadsLoad").hide();
                if(results[0] == "SUCCESS") {
                    $("#leadsDIV").html(results[1]);
                    
                    $("#leadsDIV").shiftSelectable();
                    
                    $('div[data-style="qtip-tipsy"]').qtip({
                        style: { classes: 'qtip-rounded qtip-dark qtip-pixifi' },
                        content: {
                            attr: 'data-tooltip'
                        },
                        position: {
                            viewport: $(window)
                        },
                        hide: {
                            fixed: true,
                            delay: 300
                        }
                    });

                    $('#leadsDIV [data-toggle="popover"]').popover({
                        trigger: 'hover',
                        placement: function (context, source) {
                            var position = $(source).position();
                            if (position.top < 110){
                                return "top";
                            }
                            return "bottom";
                        },
                        'show': true,
                        container: 'body'
                    });

                    $("#totalLeadsListingNumber").html(results[2]);
                    
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    
    
    
    
    
    function sortResults(section) {
        
        var sectionArray = ['id','status','date','name','type','source','created','contacted'];
        
        for(var z=0; z<sectionArray.length; z++) {
            if(section == sectionArray[z]) {
                $("#" + section + "_sort").val("1");					
            } else {
                $("#" + sectionArray[z] + "_sort").val("0");
            }
        }
        
        var pageNum = $("#currentpage").val();
        
        var view = $("#thecurrentview").val();
        
        var sectionValue = $("#" + section + "_sort").val();
        var dirValue = $("#" + section + "_sort_dir").val();
        if(dirValue == "A") {
            $("#" + section + "_sort_dir").val("D");
        } else {
            $("#" + section + "_sort_dir").val("A");
        }
        
        dirValue = $("#" + section + "_sort_dir").val();
        
        
        var error = 				"",
            errorField = 			$("#errorLeads"),
            brands = 				$("#filterBrand").val(),
            eventType = 			$("#filterEventType").val(),
            categories = 			$("#filterCategory").val(),
            categoryType = 			$("#category_filter_type").val(),
            statuses = 				$("#filterStatus").val(),
            viewFilter = 			$("#viewFilterCombo").val(),
            referralSource = 		$("#referralSourceCombo").val(),
            firstContactStart = 	$("#firstContactStart").val(),
            firstContactEnd = 		$("#firstContactEnd").val(),
            eventDateStart = 		$("#eventDateStart").val(),
            eventDateEnd = 			$("#eventDateEnd").val(),
            person = 				$("#filterStaffCombo").val(),
            numPerPage = 			$("#itemsPerPage_lead").val(),
            priority = 				$("#priorityCombo").val(),	//added on [10.09.2k18] : TH							
            readUnread = 			$("#readUnreadCombo").val(),	//added on [10.10.2k19] : TH
            
            customFieldFilters = 	$("#objectListingCustomFieldFilters").find('input,select,textarea').serialize();	//added on [05.24.2k19] : TH
            
            
            //added on [01.12.2k18] : TH
            if($('#filterStaffCombo').data('ddslick') != null && $('#filterStaffCombo').data('ddslick') != undefined) {
                if($('#filterStaffCombo').data('ddslick').selectedData != undefined) {
                    person = 		$('#filterStaffCombo').data('ddslick').selectedData.value;
                }
            }
            
            if(categories !== null) {
                if(categories.length > 0) {
                    if(categories[0] == "ALL") {
                        categories.splice(0,1);
                    }
                }
                categories = 			categories.join("||");
            }
            
            if(statuses !== null) {
                if(statuses.length > 0) {
                    if(statuses[0] == "ALL") {
                        statuses.splice(0,1);
                    }
                }
                statuses = 			statuses.join("||");
            }
            if(brands !== null) {
                if(brands.length > 0) {
                    if(brands[0] == "ALL") {
                        brands.splice(0,1);
                    }
                }
                brands = 			brands.join("||");
            }
            
            errorField.hide();
            
            $("#leadsLoad").show();
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeads/",
            data: {clientID: '12295', page: pageNum, section: section, statuses: statuses, person: person, brands: brands, viewFilter: viewFilter, eventType: eventType, readUnread: readUnread,
                    dir: dirValue, referralSource: referralSource,firstContactStart: firstContactStart, firstContactEnd: firstContactEnd, eventDateStart: eventDateStart,
                    eventDateEnd: eventDateEnd, view: view, categories: categories, numPerPage: numPerPage, categoryType: categoryType, customFieldFilters: customFieldFilters, priority: priority },
            success: function(   data   ){
                var results = 			data.split("{|}");
                $("#leadsLoad").hide();
                if(results[0] == "SUCCESS") {
                    $("#leadsDIV").html(results[1]);
                    
                    $('div[data-style="qtip-tipsy"]').qtip({
                        style: { classes: 'qtip-rounded qtip-dark qtip-pixifi' },
                        content: {
                            attr: 'data-tooltip'
                        },
                        position: {
                            viewport: $(window)
                        },
                        hide: {
                            fixed: true,
                            delay: 300
                        }
                    });

                    $('#leadsDIV [data-toggle="popover"]').popover({
                        trigger: 'hover',
                        placement: function (context, source) {
                            var position = $(source).position();
                            if (position.top < 110){
                                return "top";
                            }
                            return "bottom";
                        },
                        'show': true,
                        container: 'body'
                    });
                    
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    function changeView(view) {	
        
        var sectionArray = ['id','status','date','name','type','source','created','contacted'];
        var section = "";
        
        for(var z=0; z<sectionArray.length; z++) {
            if($("#" + sectionArray[z] + "_sort").val() == "1") {
                section = sectionArray[z];
            }
        }
        
        var viewArray = ['all','paid','sent','late','unsent'];
        
        for(var i = 0; i < viewArray.length; i++) {
            if(view == viewArray[i]) {
                $("#" +viewArray[i] + "_link").css({'background': 'url(images/nav-item-hover.png) no-repeat 100% 100%','padding': '5px 10px 10px 10px'});
            } else {
                $("#" +viewArray[i] + "_link").css({'background': 'none Transparent','padding': '0px'});
            }
        }
        // set the current view as the new view
        $("#thecurrentview").val(view);
        
        var sectionValue = $("#" + section + "_sort").val();
        var dirValue = $("#" + section + "_sort_dir").val();
        
        var pageNum = $("#currentpage").val();
        
        var error = 				"",
            errorField = 			$("#errorLeads"),
            brands = 				$("#filterBrand").val(),
            eventType = 			$("#filterEventType").val(),
            categories = 			$("#filterCategory").val(),
            categoryType = 			$("#category_filter_type").val(),
            statuses = 				$("#filterStatus").val(),
            viewFilter = 			$("#viewFilterCombo").val(),
            referralSource = 		$("#referralSourceCombo").val(),
            firstContactStart = 	$("#firstContactStart").val(),
            firstContactEnd = 		$("#firstContactEnd").val(),
            eventDateStart = 		$("#eventDateStart").val(),
            eventDateEnd = 			$("#eventDateEnd").val(),
            person = 				$("#filterStaffCombo").val(),
            numPerPage = 			$("#itemsPerPage_lead").val(),
            priority = 				$("#priorityCombo").val();	//added on [10.09.2k18] : TH
            
            //added on [01.12.2k18] : TH
            if($('#filterStaffCombo').data('ddslick') != null && $('#filterStaffCombo').data('ddslick') != undefined) {
                if($('#filterStaffCombo').data('ddslick').selectedData != undefined) {
                    person = 		$('#filterStaffCombo').data('ddslick').selectedData.value;
                }
            }
            
            if(categories !== null) {
                if(categories.length > 0) {
                    if(categories[0] == "ALL") {
                        categories.splice(0,1);
                    }
                }
                categories = 			categories.join("||");
            }
            
            if(statuses !== null) {
                if(statuses.length > 0) {
                    if(statuses[0] == "ALL") {
                        statuses.splice(0,1);
                    }
                }
                statuses = 			statuses.join("||");
            }
            if(brands !== null) {
                if(brands.length > 0) {
                    if(brands[0] == "ALL") {
                        brands.splice(0,1);
                    }
                }
                brands = 			brands.join("||");
            }
            
            errorField.hide();
            $("#leadsLoad").show();
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeads/",
            data: {clientID: '12295', page: pageNum, section: section, statuses: statuses, person: person, brands: brands, viewFilter: viewFilter, eventType: eventType, 
                    dir: dirValue, referralSource: referralSource, firstContactStart: firstContactStart, firstContactEnd: firstContactEnd, eventDateStart: eventDateStart,
                    eventDateEnd: eventDateEnd, view: view, categories: categories, numPerPage: numPerPage, categoryType: categoryType, priority: priority },
            success: function(   data   ){
                var results = 			data.split("{|}");
                $("#leadsLoad").hide();
                if(results[0] == "SUCCESS") {
                    $("#leadsDIV").html(results[1]);
                    
                    
                    $('div[data-style="qtip-tipsy"]').qtip({
                        style: { classes: 'qtip-rounded qtip-dark qtip-pixifi' },
                        content: {
                            attr: 'data-tooltip'
                        },
                        position: {
                            viewport: $(window)
                        },
                        hide: {
                            fixed: true,
                            delay: 300
                        }
                    });

                    $('#leadsDIV [data-toggle="popover"]').popover({
                        trigger: 'hover',
                        placement: function (context, source) {
                            var position = $(source).position();
                            if (position.top < 110){
                                return "top";
                            }
                            return "bottom";
                        },
                        'show': true,
                        container: 'body'
                    });
                    
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    
    var timer;
    function searchLeads(value) {	 
       clearTimeout(timer);
       timer =					setTimeout(function(){searchResults(value)},350);
    }	
    function searchResults(query) {		
        
        var sectionArray = ['id','status','date','name','type','source','created','contacted'];
        var section = "";
        
        for(var z=0; z<sectionArray.length; z++) {
            if($("#" + sectionArray[z] + "_sort").val() == "1") {
                section = sectionArray[z];
            }
        }
        
        // Set the current page globally
        var pageNum = 			$("#currentpage").val();
        
        var view = $("#thecurrentview").val();
        
        var sectionValue = $("#" + section + "_sort").val();
        var dirValue = $("#" + section + "_sort_dir").val();
        
        var error = 				"",
            errorField = 			$("#errorLeads"),
            brands = 				$("#filterBrand").val(),
            eventType = 			$("#filterEventType").val(),
            categories = 			$("#filterCategory").val(),
            categoryType = 			$("#category_filter_type").val(),
            statuses = 				$("#filterStatus").val(),
            viewFilter = 			$("#viewFilterCombo").val();
                                        
            $("#leadsLoad").show();
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getLeads/",
            data: {clientID: '12295', page: pageNum, section: section, searchQuery: query,  dir: dirValue, viewFilter: viewFilter},
            success: function(   data   ){
                var results = 			data.split("{|}");
                $("#leadsLoad").hide();
                if(results[0] == "SUCCESS") {
                    $("#leadsDIV").html(results[1]);
                    
                    $('div[data-style="qtip-tipsy"]').qtip({
                        style: { classes: 'qtip-rounded qtip-dark qtip-pixifi' },
                        content: {
                            attr: 'data-tooltip'
                        },
                        position: {
                            viewport: $(window)
                        },
                        hide: {
                            fixed: true,
                            delay: 300
                        }
                    });

                    $('#leadsDIV [data-toggle="popover"]').popover({
                        trigger: 'hover',
                        placement: function (context, source) {
                            var position = $(source).position();
                            if (position.top < 110){
                                return "top";
                            }
                            return "bottom";
                        },
                        'show': true,
                        container: 'body'
                    });
                    
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    
    
    
    
    
    function AddNewReferrer() {
        showQuickAddReferrerWindow(null);
    }
    function CancelAddNewReferrer() {
        $("#add_referrer_div").slideUp();
    }
    
    function SaveNewGlobalReferrer(   name , clientID   ) {
        $.ajax({	type: "POST",	url: "/admin/fn/misc/addNewGlobalReferrer/",
            data: {clientID: clientID, name: name},
            success: function(   data   ){
                var results = data.split("{|}");
                   if(results[0] == "SUCCESS") {
                       var referID = 			results[1];
                    // now grab the HTML for that new node, and append it to the body HTML								
                    $.ajax({ type: "GET", url: "/admin/fn/misc/displaySingleGlobalReferrer/",
                        data: {clientID: clientID, referID: referID},
                        success: function(   data   ){
                            refreshReferralSources($("#currentYearLeadStats").val());
                            CancelAddNewReferrer();
                        }
                    });
                   } else {
                       swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                   }
            }
        });				
    }
    
    
    
    function deleteGlobalReferrer( referID ) {
        swal({
            title: 'Are you sure?',
            html: 'Are you sure you want to delete this global referrer?<br /> This will delete the referrer and ALL leads and events associated with this referrer.<br /> Removing this referrrer will affect all statistics output.<br /> This action can NOT be undone!',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes',
            cancelButtonText: 'No',
            confirmButtonClass: 'confirm-class',
            cancelButtonClass: 'cancel-class',
            closeOnConfirm: true,
            closeOnCancel: true
        }, function(isConfirm) {
            if (isConfirm) {
                $.ajax({	type: "GET",	url: "/admin/fn/misc/deleteGlobalReferrer/",
                    data: "clientID=12295&referID=" +   escape(  referID  ),
                    success: function(   data   ){
                        refreshReferralSources($("#currentYearLeadStats").val());
                    }
                });
            } 
        });
    }
    
    function toggleChecked(status) {
        $(".lead-checkbox").each( function() {
            $(this).attr("checked",status);
        })
    }
    function batchUpdateLeads() {
        var leadIDs = 		[],
            errorField = 	$("#errorLeadBatch");
            
            errorField.hide();
        $("input[class=lead-checkbox]:checked").each(function() {
            leadIDs.push(this.id.replace('chk_',''));
        });
        if(leadIDs.length > 0) {
            showBatchCommandsForm();							
        } else {
            //error, no leads selected
            swal({
                type: 'error',
                title: 'Error',
                html: 'Please check at least 1 lead to batch update first...'
            });
        }
    }
    function showBatchCommandsForm() {
        $("#batchCommandsForm").slideDown();
    }
    function cancelShowBatchCommandsForm() {
        $("#batchCommandsForm").slideUp();
    }
    function getBatchValues(type) {
        $.ajax({	type: "POST",	url: "/admin/fn/leads/getBatchLeadForm/",
            data: "clientID=12295&field=" +   escape(  type  ),
            success: function(   data   ){
                var results = data.split("{|}");
                if(results[0] == "SUCCESS") {
                    if(results[1] != "hidden") {
                        $("#batchValue").html(results[1]);
                        $("#batchValue").slideDown();
                        
                        $("input[xclass=styled]:checkbox").iButton();
                        
                        tinymce.init({
                            selector: "textarea:not(.NoEditor)",
                            plugins: [
                                "advlist autolink autosave link image lists charmap print preview hr anchor pagebreak ", //spellchecker
                                "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                                "table directionality emoticons template textcolor paste fullpage textcolor" //contextmenu
                            ],
                            browser_spellcheck: true,
                            toolbar1: "insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | forecolor backcolor",
                            toolbar2: "styleselect formatselect fontselect fontsizeselect"
                        });
                        
                    } else {
                        $("#batchValue").hide();
                    }
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }								
            }
        });
    }
    
    
    function populateEmailWithData(clientID, objectName, objectID, responseID, messageField) {	
        var theIDParam = "";	
        switch(objectName) {
            case "lead":		theIDParam = "&leadID=";		break;							
        }	
        theIDParam = theIDParam + objectID;	
        $.ajax({ 
            type: 'POST', url: '/admin/data/getCommonResponseNonParsedText/',
            data: {clientID: clientID, type: objectName, responseID: responseID},
            success: function(data) {
                var results = data.split("{|}");
                   var result = results[0];
                   if(result == "SUCCESS") {
                       
                       if(tinymce == undefined || tinymce == null) {
                           $("#" + messageField).val(results[1]);	   				
                       } else {
                           var editor = tinymce.EditorManager.get(messageField)
                           if(editor) {
                            editor.setContent(results[1]);
                           } else {
                               $("#" + messageField).val(results[1]);
                           }
                       }
                       
                       if(results[2]) {
                           $("#subject_" + objectName).val(results[2]);
                       }
                   }
            }
        });
    }
    
    function insertBatchEmailSignature(messageField) {
        var brandID = 			$("#brandID").val();
        
        //If the brandID is empty, just default to the normal signature
        if(brandID !== "") {
            $.ajax({type: 'POST',url: '/admin/data/getBrandEmailSignature/',
                data: {clientID:'12295', brandID: brandID},
                success: function(data) {
                    var results = data.split("{|}");
                       var result = results[0];
                       if(result == "SUCCESS") {
                           
                           if(results[1] == "") {
                               
                               insertSignature(messageField,'12295');
                               
                           } else {
                               var msg = "<br /><br />" + results[1];
                               
                               var editor = tinymce.EditorManager.get(messageField);
                               if(editor) {
                                editor.insertContent(results[1]);
                               }
                               //$('#message_').redactor('insert.html', "<br /><br />" + results[1]);
                           }
                       } else {
                           swal({
                            type: 'error',
                            title: 'Error',
                            html: results[1]
                        });
                       }
                }
            });
            
        } else {
            insertSignature(messageField, '12295');
        }
    }
    
    function getBatchWorkflowPhases(workflowID) {
        $.ajax({	type: "POST",	url: "/admin/data/getBatchWorkflowPhases/",
            data: {clientID: '12295', workflowID: workflowID},
            success: function(   data   ){
                var results = data.split("{|}");
                if(results[0] == "SUCCESS") {
                    $("#batch_workflowmilestones").html(results[1]);
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }
            }
        });
    }
    
    
    function batchUpdateLeadsProcess() {
        var leadIDs = 		[],
            categoryIDs =	[];
        $("input[class=lead-checkbox]:checked").each(function() {
            leadIDs.push(this.id.replace('chk_',''));
        });
        if(leadIDs.length > 0) {
            var action = 			$("#action").val(),
                value = 			"",
                extraVals = 		[],
                error = 			"",
                continueStatus = 	false;
            //////////////////////////////////////////////////
            //////////////////////////////////////////////////
            //////////////////////////////////////////////////
            switch(action) {
                case "merge":
                    if(leadIDs.length > 2 || leadIDs.length < 2) {
                        swal({
                            type: 'error',
                            title: 'Error',
                            html: 'Please select only 2 Leads to Merge'
                        });
                    } else if(leadIDs.length == 2) {
                        
                        location.href="/admin/leads/merge/" + leadIDs[0] + "/" + leadIDs[1] + "/";
                        
                    }
                    break;
                case "workflow":
                    value = 			$("#batch_workflow_id").val();
                    
                    extraVals.push({name: 'startingPhaseID', value: $("input[name=milestones]:checked").val()});
                    
                    swal({
                        title: 'Are you sure?',
                        html: "Are you sure you want to apply this new workflow to all " + leadIDs.length + " lead(s) ? <br /> Any existing workflow items will be DELETED... <br /> This action can NOT be undone!",
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        confirmButtonClass: 'confirm-class',
                        cancelButtonClass: 'cancel-class',
                        closeOnConfirm: true,
                        closeOnCancel: true
                    }, function(isConfirm) {
                        if (isConfirm) {
                            processBatch(action,leadIDs,value,extraVals);
                        } 
                    });
                    break;
                case "category":
                    if($("input[class=categories-array]:checked").length > 0) {
                        $("input[class=categories-array]:checked").each(function() {
                            categoryIDs.push(this.value);
                        });
                        value = 			$.JSON.encode(categoryIDs);
                        continueStatus = 	true;
                    }
                    break;
                case "removecategory":
                    if($("input[class=categories-array]:checked").length > 0) {
                        $("input[class=categories-array]:checked").each(function() {
                            categoryIDs.push(this.value);
                        });
                        value = 			$.JSON.encode(categoryIDs);
                        continueStatus = 	true;
                    }
                    break;
                case "brand":
                    value = 			$("#batch_LeadBrandID").val();
                    continueStatus = 	true;
                    break;
                case "readunreadstatus":
                    value = 			$("input[name=value]:checked").val();
                    continueStatus = 	true;
                    break;
                case "type":
                    value = 			$("#eventType").val();
                    
                    
                    extraVals.push({name: 'objectType', value: $("#objectType").val()});
                    
                    continueStatus = 	true;
                    break;
                case "delete":
                    swal({
                        title: 'Are you sure?',
                        html: 'Are you sure you want to delete all ' + leadIDs.length + ' lead(s) ? <br /> This action can NOT be undone! Continue?',
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        confirmButtonClass: 'confirm-class',
                        cancelButtonClass: 'cancel-class',
                        closeOnConfirm: true,
                        closeOnCancel: true
                    }, function(isConfirm) {
                        if (isConfirm) {
                            processBatch(action,leadIDs,value,extraVals);
                        } 
                    });
                    break;
                case "email":
                
                    tinymce.triggerSave();
                    
                    value = 			$("#subject_lead").val();
                    var message = 		$("textarea[name=message_lead]").val();
                    
                    extraVals.push({name: 'brandID', value: $("#brandID").val()});
                    extraVals.push({name: 'emailTemplateID', value: $("#responses").val()});
                    extraVals.push({name: 'message', value: message});
                    
                    
                    error += 			(value == "") ? "Please enter a subject" : "";
                    error += 			(message == "") ? "Please enter a message" : "";
                    
                    if(error == "") {
                        continueStatus = 	true;
                    } else {
                        $("#errorLeadBatch").html(error);
                        $("#errorLeadBatch").slideDown();
                        
                    }
                    
                    break;
                default:
                    continueStatus = 	true;
                    value = 			$("#value").val();
                    break;
            }
            //////////////////////////////////////////////////
            //////////////////////////////////////////////////
            if(continueStatus) {
                processBatch(action,leadIDs,value,extraVals);
            }					
        } else {
            //error, no leads selected
        }
    }
    
    function processBatch(action,leadIDs,value,extraVals) {
        
        $("#batchLeadsLoading").show();
        
        var formData = 				[];
            formData.push({name: 'clientID', value: '12295'});
            formData.push({name: 'field', value: action});
            formData.push({name: 'leadIDs', value: leadIDs});
            formData.push({name: 'value', value: value});
            
            formData =     			formData.concat(extraVals);
        
        
        $.ajax({	type: "POST",	url: "/admin/fn/leads/batchUpdateLeads/",
            data: formData,
            success: function(   data   ){
                
                $("#batchLeadsLoading").hide();
                
                var results = data.split("{|}");
                if(results[0] == "SUCCESS") {
                    refreshLeads();
                    cancelShowBatchCommandsForm();
                    $("#checkall").attr('checked',false);
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }								
            }
        });
    }
    function switchClientType ( which ) {
        var data = which.split(":");
        if(data[1] == 1) {
            $("#clientSubType").val(data[1]);
            $("#eventType").val(data[0]);
        } else if(data[1] == 2){
            $("#clientSubType").val(data[1]);
            $("#eventType").val(data[0]);
        } else {
            $("#clientSubType").val("");
            $("#eventType").val("");
        }
    }
    
    function switchObjectType(which) {
        if(which == "project") {
            $("#lead_project_types").show();
            $("#lead_event_types").hide();
        } else {
            $("#lead_event_types").show();
            $("#lead_project_types").hide();
        }
    }
    function showProject(value) {
        $('#eventType').val(value);
        $("#clientSubType").val('2');
    }
    
    
    function clearFilter(which) {
        switch(which) {
            case "status":
                $("#filterStatus").val('');
                $("#filterStatus").change();
                $("#filterStatus").multiselect('refresh');
                break;
            case "brand":
                $("#filterBrand").val('');
                $("#filterBrand").change();
                
                $("#filterBrand").multiselect('refresh');
                break;
            case "staff":
                $("#filterStaffCombo").val('');
                $("#filterStaffCombo").change();
                break;
            case "type":
                $("#filterEventType").val('');
                $("#filterEventType").change();
                break;
            case "view":
                $("#viewFilterCombo").val('');
                $("#viewFilterCombo").change();
                break;
            case "firstcontact":
                $("#firstContactStart").val('');
                $("#firstContactEnd").val('');
                break;
            case "eventdate":
                $("#eventDateStart").val('');
                $("#eventDateEnd").val('');
                break;
            case "events":
                $("#eventStart").val('');
                $("#eventEnd").val('');
                break;
            case "referral":
                $("#referralSourceCombo").val('');
                $("#referralSourceCombo").change();
                break;	
        }
        refreshLeads();
    }
    
    function refreshEntireLeadPipelineView() {
        $.ajax({	type: "POST",	url: "/admin/fn/leads/refreshEntireLeadPipelineView/",
            data: {clientID: '12295'},
            success: function(   data   ){
                var results = data.split("|||||");
                if(results[0] == "SUCCESS") {
                    $("#leadpipelineMAINWrapper").html(results[1]);
                } else {
                    swal({
                        type: 'error',
                        title: 'Error',
                        html: results[1]
                    });
                }								
            }
        });
    }
    
</script>